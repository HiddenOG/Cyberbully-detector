<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CyberShield Feed - Live Monitoring</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
    body { background-color: #f8f9fa; }
    .flagged { border-left: 5px solid red; padding-left: 10px; margin-bottom: 10px; }
    .post, .comment { padding: 10px; border-radius: 5px; background-color: #fff; margin-bottom: 5px; }
    .comment { margin-left: 20px; }
    .alert-warning { font-size: 0.9rem; margin-top: 5px; }
    .dashboard { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .dashboard div { background-color: #fff; padding: 15px; border-radius: 8px; text-align: center; width: 20%; box-shadow: 0 0 5px rgba(0,0,0,0.1);}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">CyberShield</a>
        <div class="d-flex gap-2">
            <a class="btn btn-light btn-sm" href="/">Home</a>
            <a class="btn btn-light btn-sm" href="/paste">Paste</a>
            <a class="btn btn-light btn-sm" href="/chatbot">Chatbot</a>
            <a class="btn btn-light btn-sm" href="/facebook">Facebook</a>
            <a class="btn btn-light btn-sm" href="/facebook/live">Feed</a>
            <a class="btn btn-light btn-sm" href="/actions">Actions</a>
            <a class="btn btn-light btn-sm" href="/help">Help</a>
        </div>
    </div>
</nav>

<div class="container py-4">
    <h1 class="text-center mb-4">CyberShield Feed - Live Monitoring</h1>

    <!-- Dashboard Counters -->
    <div class="dashboard">
        <div>
            <h4 id="totalPosts">0</h4>
            <p>Total Posts</p>
        </div>
        <div>
            <h4 id="totalComments">0</h4>
            <p>Total Comments</p>
        </div>
        <div>
            <h4 id="flaggedPosts">0</h4>
            <p>Flagged Posts</p>
        </div>
        <div>
            <h4 id="flaggedComments">0</h4>
            <p>Flagged Comments</p>
        </div>
    </div>

    <!-- Posts Container -->
    <div id="postsContainer"></div>
</div>

<script>
const evtSource = new EventSource("/facebook/stream");
const postsContainer = document.getElementById("postsContainer");

let totalPosts = 0, totalComments = 0, flaggedPosts = 0, flaggedComments = 0;

evtSource.onmessage = function(event) {
    const data = JSON.parse(event.data);

    if(data.type === "post") addPostToDOM(data.post);
    else if(data.type === "comment") addCommentToDOM(data.post_id, data.comment);

    document.getElementById("totalPosts").innerText = totalPosts;
    document.getElementById("totalComments").innerText = totalComments;
    document.getElementById("flaggedPosts").innerText = flaggedPosts;
    document.getElementById("flaggedComments").innerText = flaggedComments;
};

function addPostToDOM(post) {
    totalPosts++;
    if(post.flagged) flaggedPosts++;

    const div = document.createElement("div");
    div.className = "post" + (post.flagged ? " flagged" : "");
    div.id = "post-" + post.id;

    let flaggedHTML = post.flagged ? `<div class="alert alert-warning">⚠ Flagged. <a href="/actions" class="alert-link">View actions</a></div>` : "";

    div.innerHTML = `<strong>${post.author}</strong>: ${post.text}${flaggedHTML}<div id="comments-${post.id}"></div>`;
    postsContainer.prepend(div);
}

function addCommentToDOM(postId, comment) {
    totalComments++;
    if(comment.flagged) flaggedComments++;

    const container = document.getElementById("comments-" + postId);
    if(container){
        const div = document.createElement("div");
        div.className = "comment" + (comment.flagged ? " flagged" : "");
        div.innerHTML = `<strong>${comment.author}</strong>: ${comment.text}` +
                        (comment.flagged ? `<div class="alert alert-warning">⚠ Flagged. <a href="/actions" class="alert-link">View actions</a></div>` : "");
        container.appendChild(div);
    }
}
</script>
</body>
</html>

